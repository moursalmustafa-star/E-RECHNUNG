<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Masculine Security â€” B2B Rechnung System (100% Business Ready)</title>

  <!-- PDF libs -->
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    :root{
      --ink:#0b1220;
      --muted:#475569;
      --line:#e5e7eb;
      --paper:#ffffff;
      --bg:#f5f7fb;

      --accent:#0b5fa8;
      --accent2:#0a4d86;

      --r:16px;
      --shadow:0 12px 30px rgba(15,23,42,.08);

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, Helvetica, sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:var(--sans);color:var(--ink);background:var(--bg)}

    /* ===== Topbar ===== */
    .topbar{
      position:sticky;top:0;z-index:9;
      background:rgba(255,255,255,.84);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(229,231,235,.95);
    }
    .topbarInner{
      max-width:1180px;margin:0 auto;padding:14px 14px;
      display:flex;gap:12px;align-items:center;flex-wrap:wrap;
    }
    .brand{display:flex;align-items:center;gap:12px;min-width:280px}
    .logo{
      width:44px;height:44px;border-radius:12px;
      border:1px solid rgba(229,231,235,.95);
      overflow:hidden;background:#fff;
      box-shadow:0 10px 24px rgba(15,23,42,.06);
      display:grid;place-items:center;
    }
    .logo img{width:100%;height:100%;object-fit:cover}
    .btitle{font-weight:950;letter-spacing:-.3px;line-height:1.1}
    .bsub{font-size:12px;color:var(--muted);margin-top:2px}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-left:auto}

    button{
      border:1px solid rgba(229,231,235,.98);
      background:#fff;color:#0a2540;font-weight:900;
      border-radius:12px;padding:10px 12px;cursor:pointer;
      box-shadow:0 8px 20px rgba(15,23,42,.06);
      transition: transform .06s ease, box-shadow .14s ease, border-color .14s ease;
    }
    button:hover{box-shadow:0 12px 26px rgba(15,23,42,.10);border-color:#dbe3ef}
    button:active{transform:translateY(1px)}
    button.primary{
      background:linear-gradient(180deg,var(--accent),var(--accent2));
      color:#fff;border-color:rgba(11,95,168,.35);
      box-shadow:0 14px 34px rgba(11,95,168,.22);
    }
    button.ghost{background:transparent;box-shadow:none}
    button.ok{
      background:linear-gradient(180deg,#17b897,#12a988);
      color:#fff;border-color:rgba(18,169,136,.35);
      box-shadow:0 14px 34px rgba(18,169,136,.18);
    }
    button.danger{
      background:linear-gradient(180deg,#ff4d6d,#e11d48);
      color:#fff;border-color:rgba(225,29,72,.35);
      box-shadow:0 14px 34px rgba(225,29,72,.16);
    }

    .chips{
      max-width:1180px;margin:0 auto;padding:0 14px 12px;
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;
      color:var(--muted);font-size:12px;
    }
    .chip, .tag{
      display:inline-flex;gap:8px;align-items:center;
      padding:7px 10px;border-radius:999px;
      border:1px solid rgba(229,231,235,.98);
      background:#fff;
      box-shadow:0 8px 20px rgba(15,23,42,.05);
      font-weight:900;
    }
    .chip{color:#0a2540;cursor:pointer}
    .tag{color:var(--muted)}
    .dot{width:8px;height:8px;border-radius:99px;background:#22c55e}
    .dot.gray{background:#94a3b8}

    /* ===== Layout ===== */
    .shell{
      max-width:1180px;margin:0 auto;padding:14px 14px 44px;
      display:grid;gap:14px;
    }
    @media (min-width:980px){.shell{grid-template-columns:260px 1fr}}

    .sidebar{
      background:#fff;border:1px solid rgba(229,231,235,.98);
      border-radius:16px;box-shadow:var(--shadow);
      overflow:hidden;position:sticky;top:92px;height:calc(100vh - 110px);
    }
    .shead{padding:14px 14px 10px;border-bottom:1px solid rgba(229,231,235,.98);background:linear-gradient(180deg,#fff,#fbfcff)}
    .shead .h1{font-weight:950;color:#0a2540;font-size:14px}
    .shead .h2{font-size:12px;color:var(--muted);margin-top:4px}
    .snav{padding:10px}
    .sbtn{
      width:100%;text-align:left;display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:10px 12px;border-radius:14px;border:1px solid transparent;background:transparent;
      font-weight:950;color:#0a2540;cursor:pointer;box-shadow:none;
    }
    .sbtn:hover{background:rgba(11,95,168,.06);border-color:rgba(11,95,168,.12)}
    .sbtn.active{background:linear-gradient(180deg,rgba(11,95,168,.12),rgba(11,95,168,.05));border-color:rgba(11,95,168,.18)}
    .stag{
      font-size:12px;color:var(--muted);border:1px solid rgba(229,231,235,.98);background:#fff;
      padding:4px 8px;border-radius:999px;font-family:var(--mono);
    }

    .main{min-width:0}
    .view{display:none}
    .view.active{display:block}

    .card{
      background:#fff;border:1px solid rgba(229,231,235,.98);
      border-radius:16px;box-shadow:var(--shadow);overflow:hidden;
    }
    .card h2{
      margin:0;padding:14px 16px;font-size:13px;letter-spacing:.2px;color:#0a2540;
      background:linear-gradient(180deg,#fff,#fbfcff);border-bottom:1px solid rgba(229,231,235,.98);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .card .body{padding:14px 16px}

    .grid{display:grid;gap:14px}
    @media (min-width:980px){.grid{grid-template-columns:1.35fr .85fr}}

    .row2{display:grid;gap:10px}
    @media (min-width:760px){.row2{grid-template-columns:1fr 1fr}}
    .row3{display:grid;gap:10px}
    @media (min-width:760px){.row3{grid-template-columns:1fr 1fr 1fr}}

    label{font-size:12px;color:var(--muted);display:block;margin:0 0 6px;font-weight:800}
    input,select,textarea{
      width:100%;border:1px solid rgba(229,231,235,.99);border-radius:14px;padding:11px 12px;
      font:inherit;background:#fff;outline:none;transition: box-shadow .15s ease, border-color .15s ease;
    }
    input:focus,select:focus,textarea:focus{border-color:rgba(11,95,168,.45);box-shadow:0 0 0 4px rgba(11,95,168,.10)}
    textarea{min-height:92px;resize:vertical}
    .mono{font-family:var(--mono)}
    .hr{height:1px;background:rgba(229,231,235,.98);margin:12px 0}
    .note{
      font-size:12px;color:var(--muted);
      border:1px solid rgba(229,231,235,.99);border-radius:14px;padding:10px;background:linear-gradient(180deg,#fff,#fbfcff);
    }
    .pill{
      font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid rgba(229,231,235,.98);
      background:#fff;color:var(--muted);font-family:var(--mono);white-space:nowrap;
    }

    .kpi{display:grid;gap:10px}
    @media (min-width:760px){.kpi{grid-template-columns:1fr 1fr}}
    .kpi .box{
      border:1px solid rgba(229,231,235,.99);border-radius:16px;padding:12px;background:linear-gradient(180deg,#fff,#fbfcff);
    }
    .kpi .big{font-size:22px;font-weight:950}
    .kpi .small{font-size:12px;color:var(--muted);font-weight:800}

    .table{
      width:100%;border-collapse:separate;border-spacing:0;
      border:1px solid rgba(229,231,235,.99);border-radius:16px;overflow:hidden;
    }
    .table th,.table td{padding:10px 10px;border-bottom:1px solid rgba(229,231,235,.99);font-size:13px}
    .table th{background:#f7fafc;text-align:left;color:#0a2540;font-weight:950}
    .table tr:last-child td{border-bottom:0}
    .right{text-align:right}

    .list{display:grid;gap:10px}
    .item{
      border:1px solid rgba(229,231,235,.99);border-radius:16px;padding:12px;
      display:flex;gap:12px;align-items:flex-start;justify-content:space-between;
      background:#fff;box-shadow:0 10px 26px rgba(15,23,42,.06);
    }
    .item b{display:block}
    .item small{color:var(--muted)}
    .item .btns{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}

    /* ===== PRINT / PDF ===== */
    #printWrap{display:none}
    #printA4{
      background:#fff;color:#111;
      padding:18mm 16mm;width:210mm;min-height:297mm;margin:0 auto;
    }
    .invHead{
      display:flex;justify-content:space-between;gap:16px;
      border-bottom:2px solid #111;padding-bottom:10px;margin-bottom:12px;
    }
    .invLeft{display:flex;gap:12px;align-items:center}
    .invLogo{width:52px;height:52px;border-radius:14px;overflow:hidden;border:1px solid #e5e7eb;background:#fff}
    .invLogo img{width:100%;height:100%;object-fit:cover}
    .invTitle{font-size:28px;font-weight:950;margin:0;letter-spacing:-.5px}
    .invBrand{font-size:13px;color:#111;font-weight:950;margin-top:2px}
    .invMeta{font-size:12px;color:#111;margin-top:2px}
    .metaBox{min-width:280px;border:1px solid #111;padding:10px;font-size:12px}
    .metaLine{display:flex;justify-content:space-between;gap:10px;margin:4px 0}
    .metaLine .k{font-weight:900}
    .metaLine .v{font-family:var(--mono)}
    .cols2{display:grid;gap:12px;margin-top:10px}
    @media (min-width:900px){.cols2{grid-template-columns:1fr 1fr}}
    .boxPrint{border:1px solid #111;padding:10px;font-size:12px;min-height:72px}
    .boxPrint h4{margin:0 0 8px;font-size:12px;font-weight:950}
    .boxPrint .l{margin:2px 0}
    .invTable{width:100%;border-collapse:collapse;margin-top:12px;font-size:12px}
    .invTable th,.invTable td{border:1px solid #111;padding:7px}
    .invTable th{background:#f3f4f6;text-align:left;font-weight:950}
    .invRight{text-align:right}
    .totals{
      margin-top:10px;display:grid;gap:6px;font-size:12px;max-width:380px;margin-left:auto;
    }
    .tline{display:flex;justify-content:space-between;gap:10px}
    .grand{font-size:13px;font-weight:950}
    .footer{
      margin-top:12px;font-size:11px;color:#111;border-top:1px solid #111;padding-top:10px;
    }
    .annexTitle{
      margin-top:14mm;font-size:14px;font-weight:950;border-bottom:1px solid #111;padding-bottom:6px;
    }
    .mutedSmall{font-size:11px;color:#111;margin-top:6px}
    @media print{
      body{background:#fff}
      .topbar,.chips,.shell{display:none!important}
      #printWrap{display:block!important}
      #printA4{box-shadow:none;border:none}
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbarInner">
      <div class="brand">
        <div class="logo" title="Logo (fest gespeichert)">
          <img id="logoImg" alt="Logo"/>
        </div>
        <div>
          <div class="btitle" id="topCompany">Masculine Security</div>
          <div class="bsub">B2B Rechnung â€¢ Steuerberater-Design â€¢ Anlage Einsatznachweis â€¢ Auto 99%</div>
        </div>
      </div>

      <div class="actions">
        <button class="ghost" id="btnLogo" type="button">Logo Ã¤ndern</button>
        <button class="ghost" id="btnNew" type="button">Neu</button>
        <button class="ok" id="btnSave" type="button">Rechnung speichern</button>
        <button class="ghost" id="btnList" type="button">Rechnungen</button>
        <button class="danger" id="btnReset" type="button">Reset</button>
        <button class="primary" id="btnPdf" type="button">PDF speichern</button>
        <button class="primary" id="btnPrint" type="button">Print</button>
      </div>
    </div>

    <div class="chips">
      <span class="tag"><span class="dot"></span> Auto-Save aktiv</span>
      <span class="tag" id="b2bTag"><span class="dot"></span> B2B: ON (1 Position + Anlage)</span>
      <span class="chip" id="btnCall" role="button">â˜Ž <span id="chipTel">015778697052</span></span>
      <span class="chip" id="btnMail" role="button">âœ‰ <span id="chipMail">Kontakt.mass.bremen@hotmail.com</span></span>
      <span class="tag" id="statusTag"><span class="dot gray"></span> <span id="liveStatus">Bereit</span></span>
    </div>
  </div>

  <div class="shell">
    <aside class="sidebar">
      <div class="shead">
        <div class="h1">Masculine Security</div>
        <div class="h2">B2B Rechnungssystem</div>
      </div>
      <div class="snav">
        <button class="sbtn active" id="navCreate" type="button"><span>âž• Rechnung</span><span class="stag">FORM</span></button>
        <button class="sbtn" id="navInvoices" type="button"><span>ðŸ“„ Rechnungen</span><span class="stag" id="navInvCount">0</span></button>
        <button class="sbtn" id="navCustomers" type="button"><span>ðŸ‘¤ Kunden</span><span class="stag" id="navCustCount">0</span></button>
        <button class="sbtn" id="navSettings" type="button"><span>âš™ Einstellungen</span><span class="stag">PRO</span></button>
      </div>
    </aside>

    <main class="main">

      <!-- CREATE -->
      <div class="view active" id="viewCreate">
        <div class="grid">

          <!-- FORM -->
          <div class="card">
            <h2>
              <span>Rechnungsdaten</span>
              <span style="display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end">
                <span class="pill mono" id="modePill">MODE: FEST</span>
                <span class="pill mono" id="b2bPill">B2B: ON</span>
                <span class="pill mono" id="rcPill">RC: OFF</span>
              </span>
            </h2>

            <div class="body">

              <div class="row2">
                <div>
                  <label>Firmenname / Brand *</label>
                  <input id="issuerCompany" value="Masculine Security"/>
                </div>
                <div>
                  <label>Adresse *</label>
                  <input id="issuerAddress" value="WerschenregerstraÃŸe 6 â€¢ 28237 Bremen"/>
                </div>
              </div>

              <div class="row2" style="margin-top:10px">
                <div>
                  <label>Telefon</label>
                  <input id="issuerPhone" value="015778697052"/>
                </div>
                <div>
                  <label>E-Mail *</label>
                  <input id="issuerEmail" value="Kontakt.mass.bremen@hotmail.com"/>
                </div>
              </div>

              <div class="row3" style="margin-top:10px">
                <div>
                  <label>Steuernummer / Hinweis *</label>
                  <input id="issuerTaxNo" value="wird nachgereicht"/>
                </div>
                <div>
                  <label>USt-IdNr (optional)</label>
                  <input id="issuerVatId" placeholder="DE123456789"/>
                </div>
                <div>
                  <label>Rechtsform (optional)</label>
                  <input id="issuerLegalForm" placeholder="Einzelunternehmen"/>
                </div>
              </div>

              <div class="row2" style="margin-top:10px">
                <div>
                  <label>IBAN *</label>
                  <input id="issuerIban" value="DE98 1001 1001 2333 0146 96"/>
                </div>
                <div>
                  <label>BIC *</label>
                  <input id="issuerBic" value="NTSBDEB1XXX"/>
                </div>
              </div>

              <div class="row3" style="margin-top:10px">
                <div>
                  <label>Kontoinhaber *</label>
                  <input id="issuerHolder" value="MUSTAFA MURSAL ABDI"/>
                </div>
                <div>
                  <label>Handelsregister (optional)</label>
                  <input id="issuerRegister" placeholder="HRB ... (falls vorhanden)"/>
                </div>
                <div>
                  <label>Gerichtsstand (optional)</label>
                  <input id="issuerCourt" placeholder="Bremen"/>
                </div>
              </div>

              <div class="hr"></div>

              <div class="row2">
                <div>
                  <label>Kunde auswÃ¤hlen</label>
                  <select id="customerPick"></select>
                  <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
                    <button id="btnSaveCustomer" class="ghost" type="button">Kunde speichern</button>
                    <button id="btnDeleteCustomer" class="danger" type="button">Kunde lÃ¶schen</button>
                  </div>
                </div>

                <div>
                  <label>Kundenname (zum Speichern) *</label>
                  <input id="custName" placeholder="Firma / Name"/>
                  <div class="row2" style="margin-top:10px">
                    <div>
                      <label>E-Mail (optional)</label>
                      <input id="custEmail" placeholder="kunde@email.de"/>
                    </div>
                    <div>
                      <label>Ansprechpartner (optional)</label>
                      <input id="custContact" placeholder="Ansprechpartner"/>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row2" style="margin-top:10px">
                <div>
                  <label>Kundendaten (Adresse) *</label>
                  <textarea id="custAddress" placeholder="StraÃŸe â€¢ PLZ Ort"></textarea>
                </div>
                <div>
                  <label>Kunde USt-IdNr (optional, EU B2B) </label>
                  <input id="custVatId" placeholder="z.B. ATU..., NL..., etc."/>
                  <div class="note" style="margin-top:8px">
                    Wenn EU-B2B + Reverse Charge: trage die USt-IdNr des Kunden ein und aktiviere Reverse Charge unten.
                  </div>
                </div>
              </div>

              <div class="hr"></div>

              <div class="row3">
                <div>
                  <label>Rechnungsdatum *</label>
                  <input id="invDate" type="date"/>
                </div>
                <div>
                  <label>Zahlungsziel (Tage) *</label>
                  <input id="payDays" type="number" min="0" step="1" value="14"/>
                  <div class="note" style="margin-top:8px">FÃ¤llig am = Rechnungsdatum + Zahlungsziel.</div>
                </div>
                <div>
                  <label>FÃ¤llig am *</label>
                  <input id="dueDate" type="date"/>
                </div>
              </div>

              <div class="row2" style="margin-top:10px">
                <div>
                  <label>Rechnungsnummer *</label>
                  <input id="invNo" class="mono"/>
                  <div class="note" style="margin-top:8px">Automatisch pro Tag: MS-YYYYMMDD-0001</div>
                </div>
                <div>
                  <label>Verwendungszweck (auto)</label>
                  <input id="purpose" class="mono" readonly/>
                  <div class="note" style="margin-top:8px">Kunde kann bei Ãœberweisung so schreiben.</div>
                </div>
              </div>

              <div class="hr"></div>

              <div class="row3">
                <div>
                  <label>USt-Status *</label>
                  <select id="vatMode">
                    <option value="kmu">0% (Kleinunternehmer Â§19)</option>
                    <option value="vat19">19% USt</option>
                  </select>
                  <div class="note" style="margin-top:8px" id="vatHint">GemÃ¤ÃŸ Â§19 UStG wird keine Umsatzsteuer berechnet.</div>
                </div>

                <div>
                  <label>Reverse Charge (EU B2B) *</label>
                  <select id="reverseCharge">
                    <option value="off">OFF</option>
                    <option value="on">ON (VAT 0%, Hinweis im PDF)</option>
                  </select>
                  <div class="note" style="margin-top:8px">
                    Nur aktivieren, wenn wirklich EU-B2B und Bedingungen erfÃ¼llt sind. Bei ON wird VAT = 0% und RC-Hinweis gedruckt.
                  </div>
                </div>

                <div>
                  <label>B2B Darstellung *</label>
                  <select id="b2bMode">
                    <option value="on">ON (1 Position + Anlage Einsatznachweis)</option>
               
